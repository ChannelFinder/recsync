PRAGMA foreign_keys = ON;
CREATE TABLE server (
  id INTEGER PRIMARY KEY,
  owner INTEGER,
  hostname TEXT NOT NULL,
  port INTEGER NOT NULL
);
CREATE INDEX server_ep ON server(hostname,port);
CREATE TABLE servinfo (
  id INTEGER PRIMARY KEY,
  host INTEGER NOT NULL REFERENCES server(id) ON DELETE CASCADE,
  key STRING NOT NULL,
  value STRING NOT NULL,
  UNIQUE(host, key)
);
CREATE INDEX servinfo_key ON servinfo(key);
CREATE INDEX servinfo_host ON servinfo(host);
CREATE TABLE record (
  pkey INTEGER PRIMARY KEY,
  id INTEGER NOT NULL,
  rtype STRING NOT NULL,
  rname STRING NOT NULL,
  host INTEGER NOT NULL REFERENCES server(id) ON DELETE CASCADE,
  UNIQUE(id, host),
  UNIQUE(rname, host)
);
CREATE INDEX record_rname ON record(rname);
CREATE INDEX record_host ON record(host);
CREATE UNIQUE INDEX record_id_host ON record(id, host);
CREATE UNIQUE INDEX record_rname_host ON record(rname, host);
CREATE TABLE recinfo (
  id INTEGER PRIMARY KEY,
  rec INTEGER NOT NULL REFERENCES record(pkey) ON DELETE CASCADE,
  key STRING NOT NULL,
  value STRING NOT NULL,
  UNIQUE(rec, key)
);
CREATE INDEX recinfo_key ON recinfo(key);
CREATE INDEX recinfo_rec ON recinfo(rec);
